<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="http://yui.yahooapis.com/3.18.1/build/yui/yui-min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>        
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <title>The Cycle: Frontier Items List</title>
        <link rel="stylesheet" href={{ url_for('static', filename="css/style.css") }}>
    </head>
    <body class="d-flex h-100 text-center text-white bg-dark">
    
      <div class="box">
        <div>                
          <h3 align="center" style="font-size: min(4vh, 4vw);">All items</h3>
          <input type="text" style='width:20vw; height:2.5vh;' id="searchInput" onkeyup="searchItems()" placeholder="Search...">
          
          <div id="all_items_container" class="items-box">
          {% for item in items_list: %}
            <img src= {{ url_for('static', filename=item['image_src']) }} 
            title= "{{ item['name'] }}" 
            class="item"  
            id='{{ item['name'] }}' 
            draggable="true"/>
          {% endfor %}
          </div>
        </div>
        <div class="need-want-boxes">      
          <div>    
            <h3 align="left" style="font-size: min(4vh, 4vw);">Need</h3>  
            <div id="need_items" class="need-box"></div>
          </div>
          <div>    
            <h3 align="left" style="font-size: min(4vh, 4vw);">Want</h3>        
            <div id="want_items" class="want-box"></div>
          </div>
        </div>
      </div>

      <br>          

      <footer class="mt-auto text-white-50">
        <p>A page made by Skylar Wurster (swwurster@gmail.com)</p>
      </footer>

          <script>
            var dragging = false;

            function searchItems(){
              var input, filter, i, txtValue;
              input = document.getElementById('searchInput');
              filter = input.value.toUpperCase();
              
              // Loop through all list items, and hide those who don't match the search query
              for (i = 0; i < items.length; i++) {
                txtValue = items[i].id;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                  items[i].style.display = "";
                } else {
                  items[i].style.display = "none";
                }
              }
            }
            /* draggable element */
            const items = document.querySelectorAll('.item');
            items.forEach(item => {
              item.addEventListener('dragstart', dragStart);
            });

            function dragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.id);
                dragging = true;
            }


            /* drop targets */
            const need_items = document.getElementById('need_items');
            const want_items = document.getElementById('want_items');

            need_items.addEventListener('dragenter', dragEnter);
            need_items.addEventListener('dragover', dragEnter);
            need_items.addEventListener('dragleave', dragLeave);
            need_items.addEventListener('drop', drop);
            
            want_items.addEventListener('dragenter', dragEnter);
            want_items.addEventListener('dragover', dragEnter);
            want_items.addEventListener('dragleave', dragLeave);
            want_items.addEventListener('drop', drop);
           


            function dragEnter(e) {
              e.preventDefault();
              if(dragging){
                if (e.target == need_items ||
                  e.target == want_items){
                  e.target.classList.add('drag-over');
                }
                else if(need_items.contains(e.target)){
                  need_items.classList.add('drag-over');
                }
                else if(want_items.contains(e.target)){
                  want_items.classList.add('drag-over');
                }
              }              
              else{
                e.stopPropagation();
              }
            }

            function dragLeave(e) {
              if(dragging){
                if(e.target == need_items ||
                  e.target == want_items){
                  e.target.classList.remove('drag-over');
                }
                else if(need_items.contains(e.target)){
                  need_items.classList.remove('drag-over');
                }
                else if(want_items.contains(e.target)){
                  want_items.classList.remove('drag-over');
                }
              }
              else{
                e.stopPropagation();
              }
            }

            function drop(e) {
                dragging = false;
                console.log("drop");
                if(e.target == need_items ||
                  e.target == want_items){
                    e.target.classList.remove('drag-over');
                }
                else if(need_items.contains(e.target)){
                  need_items.classList.remove('drag-over');
                }
                else if(want_items.contains(e.target)){
                  want_items.classList.remove('drag-over');
                }
                

                // get the draggable element
                const id = e.dataTransfer.getData('text/plain');
                item = document.getElementById(id);
                console.log(e.target.id);
                console.log(need_items.contains(e.target));
                if(item && item.className == "item"){
                  if(e.target.id == "need_items" ||
                    need_items.contains(e.target)){
                    add_item_to_need(item);
                  }
                  else if(e.target.id == "want_items" ||
                    want_items.contains(e.target)){
                    add_item_to_want(item);
                  }
                }                
            }
          
            function add_item_to_need(original_item){

              const new_item = document.createElement("div");
              new_item.classList.add("need-item");
              new_item.id = "need_" + original_item.id;

              const new_item_img_div = document.createElement("img");
              new_item_img_div.style.maxWidth = "100%";
              new_item_img_div.src = original_item.src;
              //new_item_img_div.style.display = "block";
              //new_item_img_div.style.height = "10vh";
              //new_item_img_div.style.width = "10vh";
              

              const new_item_name_div = document.createElement("div");
              //new_item_name_div.style.width = "20%";
              new_item_name_div.style.fontSize = "1.75vw";
              new_item_name_div.style.justifyContent = "center";
              new_item_name_div.style.textAlign = "center";
              new_item_name_div.innerHTML += original_item.id; 
              
              const first_buttons_div = document.createElement("div");
              //first_buttons_div.style.width = "25%";             
              first_buttons_div.innerHTML += '<button class="button add-button">+</button>';
              first_buttons_div.innerHTML += '<button class="button subtract-button">-</button>';

              const fraction_div = document.createElement("div");
              //fraction_div.style.width = "10%";  
              fraction_div.style.fontSize = "3vw";
              fraction_div.innerHTML += '  1&frasl;8  ';

              const second_buttons_div = document.createElement("div");
              //second_buttons_div.style.width = "25%";  
              second_buttons_div.innerHTML += '<button class="button add-button">+</button>';
              second_buttons_div.innerHTML += '<button class="button subtract-button">-</button>';

              const trash_button_div = document.createElement("div");
              trash_button_div.innerHTML = "&#128465";
              trash_button_div.addEventListener('click', function handleClick(event){
                event.target.parentElement.remove();
              });

              new_item.appendChild(new_item_img_div);
              new_item.appendChild(new_item_name_div);
              new_item.appendChild(first_buttons_div);
              new_item.appendChild(fraction_div);
              new_item.appendChild(second_buttons_div);
              new_item.appendChild(trash_button_div);
              need_items.appendChild(new_item);
            }
            function add_item_to_want(original_item){
              const new_item_img_div = document.createElement("img");
              new_item_img_div.style.maxWidth = "100%";
              new_item_img_div.src = original_item.src;
              new_item_img_div.addEventListener('click', function handleClick(event){
                event.target.remove();
              });
              want_items.appendChild(new_item_img_div);
            }
          </script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        </div>
        
    </body>

    
</html>